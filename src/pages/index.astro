---
import MainLayout from '../layouts/main.astro';
import { getCollection } from 'astro:content';

// ============================================
// é¦–é¡µé…ç½® - é›†ä¸­ç®¡ç†æ‰€æœ‰å¯é…ç½®ä¿¡æ¯
// ============================================
const homeConfig = {
  // Hero åŒºåŸŸé…ç½®
  hero: {
    title: 'å¹³å°å·¥ç¨‹ç¤¾åŒº',
    subtitle: 'Platform Engineering Community China',
    description: 'ä¸­ç«‹çš„ã€éå•†ä¸šç›®çš„ã€ä»¥å¼€æ”¾åä½œä¸ºä¸­å¿ƒçš„ä¸­æ–‡æŠ€æœ¯ç¤¾åŒº',
    stats: [
      { label: 'æœ¯è¯­å®šä¹‰', value: '20+' },
      { label: 'æœˆåˆŠæœŸæ•°', value: '12' },
      { label: 'åŸåˆ›æ–‡ç« ', value: '6' },
    ],
    buttons: [
      { title: 'æ¢ç´¢å¹³å°ä¹‹é“', link: 'https://platformers.cn', type: 'primary' },
      { title: 'åŠ å…¥ç¤¾åŒº', link: 'https://www.wenjuan.com/s/UZBZJvwQyMS/', type: 'secondary' },
    ],
  },

  // æ ¸å¿ƒæ¿å—é…ç½®
  sections: [
    {
      id: 'monthly',
      title: 'æœˆåˆŠ',
      subtitle: 'Monthly News',
      description: 'æ¯æœˆç²¾é€‰å¹³å°å·¥ç¨‹é¢†åŸŸåŠ¨æ€ã€å·¥å…·æ›´æ–°ä¸è¡Œä¸šè¶‹åŠ¿',
      icon: 'ğŸ“°',
      link: '/monthly',
      color: 'from-blue-500 to-cyan-500',
    },
    {
      id: 'articles',
      title: 'åŸåˆ›',
      subtitle: 'Original Articles',
      description: 'ç¤¾åŒºæˆå‘˜åŸåˆ›çš„æ·±åº¦æ–‡ç« ã€å®è·µç»éªŒä¸æŠ€æœ¯åˆ†äº«',
      icon: 'âœï¸',
      link: '/articles',
      color: 'from-purple-500 to-pink-500',
    },
    {
      id: 'translations',
      title: 'ç¿»è¯‘',
      subtitle: 'Translations',
      description: 'ç²¾é€‰å›½é™…ä¼˜è´¨å†…å®¹çš„ä¸­æ–‡ç¿»è¯‘ï¼Œæ‹“å±•æŠ€æœ¯è§†é‡',
      icon: 'ğŸŒ',
      link: '/translations',
      color: 'from-green-500 to-emerald-500',
    },
    {
      id: 'glossary',
      title: 'çŸ¥è¯†åœ°å›¾',
      subtitle: 'Knowledge Map',
      description: 'å¹³å°å·¥ç¨‹æ ¸å¿ƒæ¦‚å¿µä¸æœ¯è¯­çš„å¯è§†åŒ–çŸ¥è¯†å›¾è°±',
      icon: 'ğŸ—ºï¸',
      link: '/glossary',
      color: 'from-orange-500 to-yellow-500',
    },
    {
      id: 'events',
      title: 'æ´»åŠ¨',
      subtitle: 'Events',
      description: 'çº¿ä¸Šçº¿ä¸‹æŠ€æœ¯æ²™é¾™ã€ä¼šè®®ä¸ç¤¾åŒºèšä¼šä¿¡æ¯',
      icon: 'ğŸª',
      link: '/events',
      color: 'from-red-500 to-rose-500',
    },
    {
      id: 'pemm',
      title: 'PEMM',
      subtitle: 'Maturity Model',
      description: 'å¹³å°å·¥ç¨‹æˆç†Ÿåº¦æ¨¡å‹ï¼Œè¯„ä¼°ä¸æå‡å¹³å°èƒ½åŠ›',
      icon: 'ğŸ“Š',
      link: '/pemm',
      color: 'from-indigo-500 to-violet-500',
    },
  ],

  // çƒ­é—¨æœ¯è¯­é…ç½®
  hotTerms: [
    { title: 'å¹³å°å·¥ç¨‹', slug: 'platform-engineering' },
    { title: 'å†…éƒ¨å¼€å‘è€…å¹³å°', slug: 'internal-developer-platform' },
    { title: 'å¼€å‘è€…ä½“éªŒ', slug: 'developer-experience' },
    { title: 'é»„é‡‘è·¯å¾„', slug: 'golden-path' },
    { title: 'å›¢é˜Ÿæ‹“æ‰‘', slug: 'team-topologies' },
    { title: 'è®¤çŸ¥è´Ÿè·', slug: 'cognitive-load' },
    { title: 'å¹³å°å³äº§å“', slug: 'platform-as-a-product' },
    { title: 'æœ€è–„å¯è¡Œå¹³å°', slug: 'thinnest-viable-platform' },
  ],

  // é¡µè„šé…ç½®
  footer: {
    links: [
      { title: 'GitHub', url: 'https://github.com/PECommunity' },
      { title: 'è´¡çŒ®æŒ‡å—', url: 'https://github.com/PECommunity/community/blob/main/CODE_OF_CONDUCT.md' },
    ],
    copyright: 'Â© 2024 å¹³å°å·¥ç¨‹ç¤¾åŒº PECommunity',
  },
};

// ============================================
// åŠ¨æ€è·å–æœ€æ–°æ–‡ç« 
// ============================================
type ArticleEntry = {
  slug: string;
  data: {
    title: string;
    pubDate?: Date;
    description?: string;
  };
  collection: string;
};

// è·å–æ‰€æœ‰å†…å®¹é›†åˆ
const monthlyEntries = await getCollection('monthly');
const articlesEntries = await getCollection('articles');
const translationsEntries = await getCollection('translations');

// è¿‡æ»¤å¹¶æ ¼å¼åŒ–æ–‡ç« 
const formatArticles = (entries: any[], type: string, basePath: string): ArticleEntry[] => {
  return entries
    .filter((entry: any) => !entry.id.includes('README') && !entry.id.includes('index'))
    .map((entry: any) => ({
      slug: `${basePath}/${entry.id.replace(/\.(md|mdx)$/, '')}`,
      data: {
        title: entry.data.title || entry.id,
        pubDate: entry.data.pubDate,
        description: entry.data.description,
      },
      collection: type,
    }));
};

const allArticles: ArticleEntry[] = [
  ...formatArticles(monthlyEntries, 'æœˆåˆŠ', '/monthly'),
  ...formatArticles(articlesEntries, 'åŸåˆ›', '/articles'),
  ...formatArticles(translationsEntries, 'ç¿»è¯‘', '/translations'),
];

// æŒ‰æ—¥æœŸæ’åºï¼Œå–æœ€æ–° 4 ç¯‡
const latestArticles = allArticles
  .filter((a) => a.data.pubDate)
  .sort((a, b) => {
    const dateA = a.data.pubDate ? new Date(a.data.pubDate).getTime() : 0;
    const dateB = b.data.pubDate ? new Date(b.data.pubDate).getTime() : 0;
    return dateB - dateA;
  })
  .slice(0, 5);

// ç±»å‹æ ‡ç­¾é¢œè‰²æ˜ å°„
const typeColors: Record<string, string> = {
  'æœˆåˆŠ': 'bg-blue-500/20 text-blue-300 border-blue-500/30',
  'åŸåˆ›': 'bg-purple-500/20 text-purple-300 border-purple-500/30',
  'ç¿»è¯‘': 'bg-green-500/20 text-green-300 border-green-500/30',
};

// æ ¼å¼åŒ–æ—¥æœŸ
const formatDate = (date: Date | undefined) => {
  if (!date) return '';
  return new Date(date).toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};
---

<MainLayout title="å¹³å°å·¥ç¨‹ç¤¾åŒº - Platform Engineering Community China" description={homeConfig.hero.description}>
  <main class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-white">
    
    <!-- ============================================ -->
    <!-- Hero åŒºåŸŸ -->
    <!-- ============================================ -->
    <section class="relative min-h-[90vh] flex items-center justify-center overflow-hidden">
      <!-- èƒŒæ™¯ç½‘æ ¼ -->
      <div class="absolute inset-0 bg-[linear-gradient(rgba(59,130,246,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(59,130,246,0.03)_1px,transparent_1px)] bg-[size:60px_60px]"></div>
      
      <!-- å…‰æ™•æ•ˆæœ -->
      <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/20 rounded-full blur-[128px] animate-pulse"></div>
      <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-[128px] animate-pulse" style="animation-delay: 1s;"></div>
      
      <div class="relative z-10 container mx-auto px-4 text-center">
        <!-- æ ‡é¢˜ -->
        <h1 class="text-5xl md:text-7xl font-bold mb-4 bg-gradient-to-r from-white via-blue-200 to-white bg-clip-text text-transparent">
          {homeConfig.hero.title}
        </h1>
        <p class="text-lg md:text-xl text-blue-300/80 font-mono mb-6">
          {homeConfig.hero.subtitle}
        </p>
        <p class="text-xl md:text-2xl text-slate-400 max-w-2xl mx-auto mb-10">
          {homeConfig.hero.description}
        </p>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div class="flex justify-center gap-8 md:gap-16 mb-12">
          {homeConfig.hero.stats.map((stat) => (
            <div class="text-center">
              <div class="text-3xl md:text-4xl font-bold text-white mb-1">{stat.value}</div>
              <div class="text-sm text-slate-500">{stat.label}</div>
            </div>
          ))}
        </div>

        <!-- CTA æŒ‰é’® -->
        <div class="flex flex-wrap gap-4 justify-center">
          {homeConfig.hero.buttons.map((btn) => (
            <a
              href={btn.link}
              target={btn.link.startsWith('http') ? '_blank' : undefined}
              rel={btn.link.startsWith('http') ? 'noopener noreferrer' : undefined}
              class={`px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-300 ${
                btn.type === 'primary'
                  ? 'bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white shadow-lg shadow-blue-500/25 hover:shadow-blue-500/40 hover:scale-105'
                  : 'bg-slate-800/50 border border-slate-700 hover:border-slate-600 hover:bg-slate-800 text-slate-300'
              }`}
            >
              {btn.title}
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- æ ¸å¿ƒæ¿å— -->
    <!-- ============================================ -->
    <section class="py-24 relative">
      <div class="container mx-auto px-4">
        <div class="text-center mb-16">
          <h2 class="text-3xl md:text-4xl font-bold mb-4">æ¢ç´¢ç¤¾åŒºå†…å®¹</h2>
          <p class="text-slate-400 max-w-2xl mx-auto">
            ä»æœˆåº¦æ´å¯Ÿåˆ°æ·±åº¦åŸåˆ›ï¼Œä»å›½é™…è§†é‡åˆ°æœ¬åœŸå®è·µï¼Œå…¨æ–¹ä½äº†è§£å¹³å°å·¥ç¨‹
          </p>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {homeConfig.sections.map((section) => (
            <a
              href={section.link}
              class="group relative p-6 rounded-2xl bg-slate-800/30 border border-slate-700/50 hover:border-slate-600 transition-all duration-300 hover:scale-[1.02] hover:bg-slate-800/50"
            >
              <!-- æ¸å˜å…‰æ•ˆ -->
              <div class={`absolute inset-0 rounded-2xl bg-gradient-to-br ${section.color} opacity-0 group-hover:opacity-10 transition-opacity duration-300`}></div>
              
              <div class="relative z-10">
                <div class="text-4xl mb-4">{section.icon}</div>
                <h3 class="text-xl font-bold mb-1 text-white group-hover:text-blue-300 transition-colors">
                  {section.title}
                </h3>
                <p class="text-sm text-slate-500 font-mono mb-3">{section.subtitle}</p>
                <p class="text-slate-400 text-sm leading-relaxed">{section.description}</p>
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- æœ€æ–°æ–‡ç«  -->
    <!-- ============================================ -->
    <section class="py-24 bg-slate-900/50 relative">
      <!-- è£…é¥°çº¿ -->
      <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-slate-700 to-transparent"></div>
      
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between mb-12">
          <div>
            <h2 class="text-3xl md:text-4xl font-bold mb-2">æœ€æ–°å†…å®¹</h2>
            <p class="text-slate-400">æ¥è‡ªæœˆåˆŠã€åŸåˆ›å’Œç¿»è¯‘çš„æœ€æ–°å‘å¸ƒ</p>
          </div>
          <a href="/monthly" class="hidden md:flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors">
            æŸ¥çœ‹å…¨éƒ¨
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
          </a>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          {latestArticles.map((article, index) => (
            <a
              href={article.slug}
              class={`group relative p-6 rounded-2xl border border-slate-700/50 hover:border-slate-600 transition-all duration-300 ${
                index === 0 ? 'md:col-span-2 bg-gradient-to-br from-slate-800/50 to-slate-900/50' : 'bg-slate-800/30'
              }`}
            >
              <div class="flex items-start justify-between gap-4">
                <div class="flex-1">
                  <!-- ç±»å‹æ ‡ç­¾ -->
                  <span class={`inline-block px-3 py-1 rounded-full text-xs font-medium border mb-3 ${typeColors[article.collection]}`}>
                    {article.collection}
                  </span>
                  
                  <h3 class={`font-bold text-white group-hover:text-blue-300 transition-colors mb-2 ${index === 0 ? 'text-2xl' : 'text-lg'}`}>
                    {article.data.title}
                  </h3>
                  
                  {article.data.description && index === 0 && (
                    <p class="text-slate-400 text-sm line-clamp-2 mb-3">{article.data.description}</p>
                  )}
                  
                  <div class="text-sm text-slate-500">
                    {formatDate(article.data.pubDate)}
                  </div>
                </div>

                <!-- ç®­å¤´ -->
                <div class="text-slate-600 group-hover:text-blue-400 group-hover:translate-x-1 transition-all mt-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                  </svg>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- çŸ¥è¯†åœ°å›¾é¢„è§ˆ -->
    <!-- ============================================ -->
    <section class="py-24 relative overflow-hidden">
      <!-- èƒŒæ™¯è£…é¥° -->
      <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,rgba(59,130,246,0.1),transparent_70%)]"></div>
      
      <div class="container mx-auto px-4 relative z-10">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold mb-4">çŸ¥è¯†åœ°å›¾</h2>
          <p class="text-slate-400 max-w-2xl mx-auto">
            æ¢ç´¢å¹³å°å·¥ç¨‹æ ¸å¿ƒæ¦‚å¿µï¼Œå»ºç«‹ç³»ç»ŸåŒ–çš„çŸ¥è¯†ä½“ç³»
          </p>
        </div>

        <!-- æœ¯è¯­æ ‡ç­¾äº‘ -->
        <div class="flex flex-wrap justify-center gap-3 mb-12 max-w-4xl mx-auto">
          {homeConfig.hotTerms.map((term, index) => (
            <a
              href={`/glossary/${term.slug}`}
              class="px-4 py-2 rounded-full bg-slate-800/50 border border-slate-700/50 text-slate-300 hover:text-white hover:border-blue-500/50 hover:bg-blue-500/10 transition-all duration-300"
              style={`animation-delay: ${index * 0.05}s`}
            >
              {term.title}
            </a>
          ))}
        </div>

        <div class="text-center">
          <a
            href="/glossary"
            class="inline-flex items-center gap-2 px-8 py-4 rounded-xl bg-gradient-to-r from-blue-600/20 to-cyan-600/20 border border-blue-500/30 text-blue-300 hover:text-white hover:border-blue-500/50 hover:from-blue-600/30 hover:to-cyan-600/30 transition-all duration-300"
          >
            æ¢ç´¢å®Œæ•´çŸ¥è¯†åœ°å›¾
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- é¡µè„š -->
    <!-- ============================================ -->
    <footer class="py-12 border-t border-slate-800">
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row items-center justify-between gap-6">
          <div class="text-slate-500 text-sm">
            {homeConfig.footer.copyright}
          </div>
          <div class="flex items-center gap-6">
            {homeConfig.footer.links.map((link) => (
              <a
                href={link.url}
                target="_blank"
                rel="noopener noreferrer"
                class="text-slate-400 hover:text-white transition-colors text-sm"
              >
                {link.title}
              </a>
            ))}
          </div>
        </div>
      </div>
    </footer>
  </main>
</MainLayout>

<style>
  /* åŠ¨ç”»æ•ˆæœ */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  section {
    animation: fadeInUp 0.6s ease-out;
  }

  /* æ ‡ç­¾äº‘åŠ¨ç”» */
  .flex-wrap a {
    animation: fadeInUp 0.4s ease-out both;
  }
</style>
