---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/main.astro';
import { Typography } from '../../components/Typography';
import type { GetStaticPaths } from 'astro';
import type { CollectionEntry } from 'astro:content';

export const getStaticPaths: GetStaticPaths = async () => {
  const monthlyArticles = await getCollection('monthly');
  
  return monthlyArticles
    .filter((article: CollectionEntry<'monthly'>) => !article.id.includes('README'))
    .map((article: CollectionEntry<'monthly'>) => ({
      params: { slug: article.id.replace(/\.(md|mdx)$/, '') },
      props: { article },
    }));
}

interface Props {
  article: CollectionEntry<'monthly'>;
}

const { article } = Astro.props;
const { Content } = await render(article);

const formattedDate = article.data.pubDate?.toLocaleDateString('zh-CN', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<Layout title={article.data.title}>
  <article class="container mx-auto px-4 py-8 max-w-4xl">
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4">{article.data.title}</h1>
      {article.data.description && (
        <p class="text-xl text-gray-600 mb-4">{article.data.description}</p>
      )}
      <div class="flex items-center gap-4 text-sm text-gray-500 mb-4">
        {article.data.pubDate && (
          <time datetime={article.data.pubDate.toISOString()}>
            {formattedDate}
          </time>
        )}
        {article.data.author && (
          <span>作者：{article.data.author}</span>
        )}
      </div>
      {article.data.tags && article.data.tags.length > 0 && (
        <div class="flex gap-2">
          {article.data.tags.map((tag: string) => (
            <span class="text-xs bg-gray-100 px-2 py-1 rounded">{tag}</span>
          ))}
        </div>
      )}
    </header>
    
    <Typography>
      <Content />
    </Typography>
  </article>
</Layout>
